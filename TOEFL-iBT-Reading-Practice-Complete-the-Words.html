<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOEFL iBT Reading Practice - Complete the Words</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .task-card {
            transition: all 0.3s ease;
        }
        /* Style for the fill-in-the-blank inputs */
        .fill-in {
            border: none;
            border-bottom: 2px solid #94A3B8; /* slate-400 */
            outline: none;
            text-align: center;
            font-weight: 600;
            color: #2563EB; /* blue-600 */
            transition: all 0.2s ease;
            padding: 2px;
            margin: 0 4px;
        }
        .fill-in:focus {
            border-bottom-color: #3B82F6; /* blue-500 */
            transform: scale(1.05);
        }
        
        .input-correct {
            border-bottom-color: #10B981 !important; /* green-500 */
            background-color: #D1FAE5; /* green-100 */
        }
        .input-incorrect {
            border-bottom-color: #EF4444 !important; /* red-500 */
            background-color: #FEE2E2; /* red-100 */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8 max-w-4xl">

        <!-- Header -->
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-blue-700">TOEFL iBT Reading Practice</h1>
            <p class="text-lg text-slate-600 mt-2">Task: Complete the Words – Fill in Missing Letters in Context</p>
            <p class="text-md text-slate-500 font-medium">Levels: A2 → B2 (Progressive Difficulty)</p>
        </header>

        <div id="score-tracker" class="sticky top-0 bg-white/80 backdrop-blur-sm z-10 p-4 rounded-lg shadow-md mb-8 flex flex-col sm:flex-row justify-center items-center gap-4">
            <h2 class="text-xl font-bold text-slate-700">Your Score: <span id="score" class="text-blue-700">0</span> / <span id="total">71</span></h2>
        </div>

        <main class="space-y-8">

            <!-- A2 Level -->
            <section class="task-card bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-6 text-blue-600">A2 Level (Items 1–10)</h2>
                <div id="a2" class="space-y-4 text-lg">
                    <p>1. I rea<input id="q1_1" type="text" size="1" maxlength="1" class="fill-in"> a bo<input id="q1_2" type="text" size="2" maxlength="2" class="fill-in"> before bed.</p>
                    <p>2. The sun is sh<input id="q2_1" type="text" size="5" maxlength="5" class="fill-in"> today.</p>
                    <p>3. We st<input id="q3_1" type="text" size="3" maxlength="3" class="fill-in"> at school in the morn<input id="q3_2" type="text" size="3" maxlength="3" class="fill-in">.</p>
                    <p>4. She is dri<input id="q4_1" type="text" size="4" maxlength="4" class="fill-in"> coffee in the café.</p>
                    <p>5. My fri<input id="q5_1" type="text" size="3" maxlength="3" class="fill-in"> and I play foo<input id="q5_2" type="text" size="4" maxlength="4" class="fill-in">.</p>
                    <p>6. It is imp<input id="q6_1" type="text" size="6" maxlength="6" class="fill-in"> to eat brea<input id="q6_2" type="text" size="4" maxlength="4" class="fill-in"> every day.</p>
                    <p>7. He wa<input id="q7_1" type="text" size="4" maxlength="4" class="fill-in"> TV in the evening.</p>
                    <p>8. The te<input id="q8_1" type="text" size="4" maxlength="4" class="fill-in"> gives us homework.</p>
                    <p>9. We ha<input id="q9_1" type="text" size="2" maxlength="2" class="fill-in"> lunch at tw<input id="q9_2"type="text" size="4" maxlength="4" class="fill-in"> o’clock.</p>
                    <p>10. They wor<input id="q10_1" type="text" size="1" maxlength="1" class="fill-in"> hard every day.</p>
                </div>
                <div class="mt-8 text-center space-x-4">
                    <button data-section="a2" class="check-btn bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">Check A2 Answers</button>
                    <button data-section="a2" class="retry-btn bg-yellow-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-yellow-600 transition hidden">Retry</button>
                </div>
            </section>
            
            <!-- A2 -> B1 Level -->
            <section class="task-card bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-6 text-blue-600">A2 → B1 Level (Items 11–20)</h2>
                <div id="b1_1" class="space-y-4 text-lg">
                    <p>11. Scientists do exp<input id="q11_1" type="text" size="8" maxlength="8" class="fill-in"> to learn new things.</p>
                    <p>12. The stu<input id="q12_1" type="text" size="5" maxlength="5" class="fill-in"> are taking a test today.</p>
                    <p>13. She wro<input id="q13_1" type="text" size="2" maxlength="2" class="fill-in"> an e-ma<input id="q13_2" type="text" size="2" maxlength="2" class="fill-in"> to her teacher.</p>
                    <p>14. Peo<input id="q14_1" type="text" size="3" maxlength="3" class="fill-in"> use en<input id="q14_2" type="text" size="4" maxlength="4" class="fill-in"> to pow<input id="q14_3" type="text" size="2" maxlength="2" class="fill-in"> their homes.</p>
                    <p>15. I need to com<input id="q15_1" type="text" size="5" maxlength="5" class="fill-in"> my project this week.</p>
                    <p>16. He wor<input id="q16_1" type="text" size="2" maxlength="2" class="fill-in"> as an engi<input id="q16_2" type="text" size="4" maxlength="4" class="fill-in"> in the city.</p>
                    <p>17. The mu<input id="q17_1" type="text" size="2" maxlength="2" class="fill-in"> is very beautiful.</p>
                    <p>18. The cl<input id="q18_1" type="text" size="3" maxlength="3" class="fill-in"> starts at nine o’clock.</p>
                    <p>19. Stu<input id="q19_1" type="text" size="5" maxlength="5" class="fill-in"> must bring their tex<input id="q19_2" type="text" size="4" maxlength="4" class="fill-in"> to class.</p>
                    <p>20. I don’t li<input id="q20_1" type="text" size="2" maxlength="2" class="fill-in"> rainy weather.</p>
                </div>
                <div class="mt-8 text-center space-x-4">
                    <button data-section="b1_1" class="check-btn bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">Check A2 → B1 Answers</button>
                    <button data-section="b1_1" class="retry-btn bg-yellow-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-yellow-600 transition hidden">Retry</button>
                </div>
            </section>
            
            <!-- B1 Level -->
            <section class="task-card bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-6 text-blue-600">B1 Level (Items 21–30)</h2>
                <div id="b1_2" class="space-y-4 text-lg">
                    <p>21. The exp<input id="q21_1" type="text" size="7" maxlength="7" class="fill-in"> showed new resu<input id="q21_2" type="text" size="3" maxlength="3" class="fill-in">.</p>
                    <p>22. The uni<input id="q22_1" type="text" size="7" maxlength="7" class="fill-in"> has a large library.</p>
                    <p>23. The teac<input id="q23_1" type="text" size="3" maxlength="3" class="fill-in"> encouraged us to ask qu<input id="q23_2" type="text" size="7" maxlength="7" class="fill-in">.</p>
                    <p>24. Students col<input id="q24_1" type="text" size="5" maxlength="5" class="fill-in"> data during the exp<input id="q24_2" type="text" size="7" maxlength="7" class="fill-in">.</p>
                    <p>25. Many animals live in the oce<input id="q25_1" type="text" size="2" maxlength="2" class="fill-in">.</p>
                    <p>26. It is imp<input id="q26_1" type="text" size="6" maxlength="6" class="fill-in"> to save wat<input id="q26_2" type="text" size="2" maxlength="2" class="fill-in">.</p>
                    <p>27. The gov<input id="q27_1" type="text" size="6" maxlength="6" class="fill-in"> wants to reduce poll<input id="q27_2" type="text" size="5" maxlength="5" class="fill-in">.</p>
                    <p>28. Peo<input id="q28_1" type="text" size="3" maxlength="3" class="fill-in"> need exer<input id="q28_2" type="text" size="4" maxlength="4" class="fill-in"> to stay healthy.</p>
                    <p>29. The com<input id="q29_1" type="text" size="6" maxlength="6" class="fill-in"> was very interesting.</p>
                    <p>30. The sci<input id="q30_1" type="text" size="5" maxlength="5" class="fill-in"> wrote a rep<input id="q30_2" type="text" size="3" maxlength="3" class="fill-in"> about her findings.</p>
                </div>
                <div class="mt-8 text-center space-x-4">
                    <button data-section="b1_2" class="check-btn bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">Check B1 Answers</button>
                    <button data-section="b1_2" class="retry-btn bg-yellow-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-yellow-600 transition hidden">Retry</button>
                </div>
            </section>
            
            <!-- B2 Level -->
            <section class="task-card bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-2xl font-semibold mb-6 text-blue-600">B2 Level (Items 31–40)</h2>
                <div id="b2" class="space-y-4 text-lg">
                    <p>31. The rese<input id="q31_1" type="text" size="6" maxlength="6" class="fill-in"> found strong evid<input id="q31_2" type="text" size="4" maxlength="4" class="fill-in"> for the theory.</p>
                    <p>32. Uni<input id="q32_1" type="text" size="8" maxlength="8" class="fill-in"> offer courses in many subj<input id="q32_2" type="text" size="5" maxlength="5" class="fill-in">.</p>
                    <p>33. The exper<input id="q33_1" type="text" size="9" maxlength="9" class="fill-in"> results were ana<input id="q33_2" type="text" size="5" maxlength="5" class="fill-in"> carefully.</p>
                    <p>34. Tec<input id="q34_1" type="text" size="8" maxlength="8" class="fill-in"> has changed the way we commu<input id="q34_2" type="text" size="8" maxlength="8" class="fill-in">.</p>
                    <p>35. The stu<input id="q35_1" type="text" size="2" maxlength="2" class="fill-in"> compared two dif<input id="q35_2" type="text" size="7" maxlength="7" class="fill-in"> methods.</p>
                    <p>36. Envi<input id="q36_1" type="text" size="10" maxlength="10" class="fill-in"> problems are becoming more ser<input id="q36_2" type="text" size="5" maxlength="5" class="fill-in">.</p>
                    <p>37. The compa<input id="q37_1" type="text" size="2" maxlength="2" class="fill-in"> is plan<input id="q37_2" type="text" size="5" maxlength="5" class="fill-in"> to open a new branch.</p>
                    <p>38. The art<input id="q38_1" type="text" size="4" maxlength="4" class="fill-in"> discu<input id="q38_2" type="text" size="5" maxlength="5" class="fill-in"> the causes of clim<input id="q38_3" type="text" size="3" maxlength="3" class="fill-in"> change.</p>
                    <p>39. The rese<input id="q39_1" type="text" size="6" maxlength="6" class="fill-in"> used acc<input id="q39_2" type="text" size="6" maxlength="6" class="fill-in"> data to supp<input id="q39_3" type="text" size="3" maxlength="3" class="fill-in"> her argu<input id="q39_4" type="text" size="4" maxlength="4" class="fill-in">.</p>
                    <p>40. The scie<input id="q40_1" type="text" size="6" maxlength="6" class="fill-in"> presented her find<input id="q40_2" type="text" size="4" maxlength="4" class="fill-in"> at a conf<input id="q40_3" type="text" size="7" maxlength="7" class="fill-in">.</p>
                </div>
                <div class="mt-8 text-center space-x-4">
                    <button data-section="b2" class="check-btn bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">Check B2 Answers</button>
                    <button data-section="b2" class="retry-btn bg-yellow-500 text-white font-bold py-2 px-6 rounded-lg hover:bg-yellow-600 transition hidden">Retry</button>
                </div>
            </section>
            
        </main>

        <footer class="text-center mt-12 py-6 text-slate-500 text-sm">
            Designed by <a href="https://fajarudinakbar.online" target="_blank" class="text-blue-600 hover:underline">fajarudinakbar.online</a>
        </footer>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let score = 0;
            const scoreElement = document.getElementById('score');
            
            // Store original text for check buttons
            document.querySelectorAll('.check-btn').forEach(btn => {
                btn.dataset.originalText = btn.textContent;
            });

            // Remove the global retry button logic
            /*
            const retryAllBtn = document.getElementById('retry-all');
            retryAllBtn.addEventListener('click', () => {
                location.reload();
            });
            */
            // Remove the 'retry-all' button from the DOM
            const retryAllBtn = document.getElementById('retry-all');
            if (retryAllBtn) {
                retryAllBtn.remove();
            }


            const updateScore = (points) => {
                score += points;
                scoreElement.textContent = score;
            };

            // Master Answer Key (lowercase)
            const answerKeys = {
                a2: {
                    q1_1: 'd', q1_2: 'ok',
                    q2_1: 'ining',
                    q3_1: 'udy', q3_2: 'ing',
                    q4_1: 'king',
                    q5_1: 'end', q5_2: 'ball',
                    q6_1: 'ortant', q6_2: 'fast',
                    q7_1: 'ches',
                    q8_1: 'cher',
                    q9_1: 've', q9_2: 'elve',
                    q10_1: 'k'
                },
                b1_1: {
                    q11_1: 'eriments',
                    q12_1: 'dents',
                    q13_1: 'te', q13_2: 'il',
                    q14_1: 'ple', q14_2: 'ergy', q14_3: 'er',
                    q15_1: 'plete',
                    q16_1: 'ks', q16_2: 'neer',
                    q17_1: 'ic',
                    q18_1: 'ass',
                    q19_1: 'dents', q19_2: 'book',
                    q20_1: 'ke'
                },
                b1_2: {
                    q21_1: 'eriment', q21_2: 'lts',
                    q22_1: 'ersity',
                    q23_1: 'her', q23_2: 'estions',
                    q24_1: 'ected', q24_2: 'eriment',
                    q25_1: 'an',
                    q26_1: 'ortant', q26_2: 'er',
                    q27_1: 'ernment', q27_2: 'ution',
                    q28_1: 'ple', q28_2: 'cise',
                    q29_1: 'unity',
                    q30_1: 'ntist', q30_2: 'ort'
                },
                b2: {
                    q31_1: 'archer', q31_2: 'ence',
                    q32_1: 'ersities', q32_2: 'ects',
                    q33_1: 'imental', q33_2: 'yzed',
                    q34_1: 'nology', q34_2: 'nicate',
                    q35_1: 'dy', q35_2: 'ferent',
                    q36_1: 'onmental', q36_2: 'ious',
                    q37_1: 'ny', q37_2: 'ning',
                    q38_1: 'icle', q38_2: 'ssed', q38_3: 'ate',
                    q39_1: 'archer', q39_2: 'urate', q39_3: 'ort', q39_4: 'ment',
                    q40_1: 'ntist', q40_2: 'ings', q40_3: 'erence'
                }
            };

            // To track scores per section, preventing double-counting
            const sectionScores = { a2: 0, b1_1: 0, b1_2: 0, b2: 0 };

            /**
             * Checks the answers for a given section with 2-attempt logic.
             * @param {string} sectionKey - The key for the answerKeys object (e.g., 'a2', 'b1_1').
             * @param {HTMLElement} button - The button that was clicked.
             */
            function checkSection(sectionKey, button) {
                // Get attempt count from the button's parent section
                const sectionElement = button.closest('section');
                let attempts = parseInt(sectionElement.dataset.attempts || 0);
                attempts++;
                sectionElement.dataset.attempts = attempts;

                const isFinalAttempt = (attempts >= 2); // Check if this is the 2nd (or later) attempt

                const answerKey = answerKeys[sectionKey];
                let correctCountThisAttempt = 0;
                let totalInputsInSection = 0;
                let incorrectInputs = []; // To track which ones to show answers for

                // First, subtract the old score for this section before recalculating
                updateScore(-sectionScores[sectionKey]);
                let newSectionScore = 0;

                Object.keys(answerKey).forEach(key => {
                    totalInputsInSection++;
                    const input = document.getElementById(key);
                    if (input) {
                        // Don't re-check already disabled (i.e., correct from a previous attempt) inputs
                        /* REMOVED: This logic is now changed. We re-check all inputs.
                        if (input.disabled && input.classList.contains('input-correct')) {
                            newSectionScore++; // Keep counting previously correct answers
                            return;
                        }
                        */

                        const userAnswer = input.value.trim().toLowerCase();
                        const correctAnswer = answerKey[key];
                        
                        input.classList.remove('input-correct', 'input-incorrect');
                        
                        if (userAnswer === correctAnswer) {
                            input.classList.add('input-correct');
                            newSectionScore++;
                            if (isFinalAttempt) { // Only disable on the final attempt
                                input.disabled = true;
                            }
                        } else {
                            input.classList.add('input-incorrect');
                            incorrectInputs.push(input); // Add to list for attempt 2
                            if (isFinalAttempt) { // On final attempt, disable and show answer
                                input.value = correctAnswer;
                                input.classList.remove('input-incorrect');
                                input.classList.add('input-correct');
                                input.disabled = true;
                            }
                        }
                    }
                });

                // Update global score with the new total score for this section
                sectionScores[sectionKey] = newSectionScore;
                updateScore(newSectionScore);

                // --- Handle Attempts & Feedback ---

                // Find or create feedback element
                let feedbackEl = sectionElement.querySelector('.feedback-msg');
                if (!feedbackEl) {
                    feedbackEl = document.createElement('p');
                    feedbackEl.className = 'feedback-msg mt-4 text-sm font-medium';
                    button.insertAdjacentElement('afterend', feedbackEl);
                }

                if (!isFinalAttempt) { // This is Attempt 1
                    if (newSectionScore === totalInputsInSection) {
                        // Perfect score on first try
                        feedbackEl.textContent = `You got ${newSectionScore} out of ${totalInputsInSection} correct. Well done!`;
                        feedbackEl.className = 'feedback-msg mt-4 text-sm font-medium text-green-600';
                        button.textContent = 'Checked!';
                        button.disabled = true;
                        button.classList.add('bg-gray-400', 'cursor-not-allowed');
                        // Also disable all inputs since they got it perfect
                        sectionElement.querySelectorAll('.fill-in').forEach(input => input.disabled = true);
                    } else {
                        // Not perfect, allow second attempt
                        feedbackEl.textContent = `You got ${newSectionScore} out of ${totalInputsInSection}. Review your answers and try again!`;
                        feedbackEl.className = 'feedback-msg mt-4 text-sm font-medium text-yellow-700';
                        button.textContent = 'Check Again'; // Change button text
                    }
                } else if (attempts >= 2) { // This is the Final Attempt (Attempt 2)
                    // This is the second attempt
                    button.textContent = 'Checked!';
                    button.disabled = true;
                    button.classList.add('bg-gray-400', 'cursor-not-allowed');

                    // Show correct answers for remaining incorrect inputs
                    /* MOVED: This logic is now inside the forEach loop
                    incorrectInputs.forEach(input => {
                        const correctAnswer = answerKeys[sectionKey][input.id];
                        input.value = correctAnswer;
                        input.classList.remove('input-incorrect');
                        input.classList.add('input-correct'); // Show it as correct now
                        input.disabled = true;
                    });
                    */

                    if (newSectionScore === totalInputsInSection) {
                        feedbackEl.textContent = `You got ${newSectionScore} out of ${totalInputsInSection} correct on the second try!`;
                        feedbackEl.className = 'feedback-msg mt-4 text-sm font-medium text-green-600';
                    } else {
                        feedbackEl.textContent = `Final score for this section: ${newSectionScore} out of ${totalInputsInSection}. Correct answers are shown.`;
                        feedbackEl.className = 'feedback-msg mt-4 text-sm font-medium text-red-600';
                    }
                }
                
                // Show the "Retry" button for this section
                const retryBtn = sectionElement.querySelector('.retry-btn');
                if (retryBtn) {
                    retryBtn.classList.remove('hidden');
                }
            }

            // Add event listeners to all check buttons
            document.querySelectorAll('.check-btn').forEach(button => {
                button.addEventListener('click', () => {
                    // We don't check button.disabled here because "Check Again" is not disabled
                    const sectionKey = button.getAttribute('data-section');
                    checkSection(sectionKey, button);
                });
            });

            // Add new event listeners for all section "Retry" buttons
            document.querySelectorAll('.retry-btn').forEach(button => {
                button.addEventListener('click', () => {
                    const sectionKey = button.getAttribute('data-section');
                    const sectionElement = button.closest('section');
                    if (!sectionElement || !sectionKey) return;

                    // 1. Subtract this section's score from the total score
                    updateScore(-sectionScores[sectionKey]);
                    
                    // 2. Reset the section score and attempts
                    sectionScores[sectionKey] = 0;
                    sectionElement.dataset.attempts = 0;

                    // 3. Re-enable all inputs, clear them, and remove classes
                    sectionElement.querySelectorAll('.fill-in').forEach(input => {
                        input.disabled = false;
                        input.value = '';
                        input.classList.remove('input-correct', 'input-incorrect');
                    });

                    // 4. Reset the "Check" button
                    const checkBtn = sectionElement.querySelector('.check-btn');
                    if (checkBtn) {
                        checkBtn.disabled = false;
                        checkBtn.textContent = checkBtn.dataset.originalText;
                        checkBtn.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    }

                    // 5. Remove the feedback message
                    const feedbackEl = sectionElement.querySelector('.feedback-msg');
                    if (feedbackEl) {
                        feedbackEl.remove();
                    }

                    // 6. Hide the "Retry" button itself
                    button.classList.add('hidden');
                });
            });
        });
    </script>
</body>
</html>
