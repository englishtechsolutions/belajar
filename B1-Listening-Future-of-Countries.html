<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B1 Listening - Future of Countries</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        /* Base styles */
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        
        /* Section animations */
        .worksheet-section {
            display: none;
        }
        .worksheet-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Answer feedback styles */
        .correct {
            border-color: #10b981 !important; /* emerald-500 */
            background-color: #ecfdf5 !important; /* emerald-50 */
        }
        .incorrect {
            border-color: #f43f5e !important; /* rose-500 */
            background-color: #fff1f2 !important; /* rose-50 */
        }
        .correct-answer-text {
            color: #047857; /* emerald-700 */
            font-weight: 600;
        }
        .correct-radio + label {
            color: #10b981;
            font-weight: bold;
        }
        .summary-blank.correct, .table-select.correct, .vocab-select.correct {
             border-color: #10b981 !important;
             box-shadow: 0 0 0 2px #a7f3d0;
        }
        .summary-blank.incorrect, .table-select.incorrect, .vocab-select.incorrect {
             border-color: #f43f5e !important;
             box-shadow: 0 0 0 2px #fecdd3;
        }

        /* Hide scrollbar for the sidebar on webkit browsers */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="flex min-h-screen">
        <!-- Sidebar Navigation -->
        <aside class="w-64 bg-white border-r border-slate-200 p-6 flex-col hidden md:flex">
            <nav id="lesson-nav" class="space-y-2 flex-1 no-scrollbar overflow-y-auto"></nav>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 p-4 sm:p-6 lg:p-10">
            <div class="max-w-4xl mx-auto">
                <header class="mb-10">
                    <div class="p-4 bg-sky-400 rounded-full w-12 h-12 flex items-center justify-center mb-4 text-2xl">
                        üåê
                    </div>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-slate-900 tracking-tight">Future of Countries</h1>
                    <p class="text-lg text-slate-600 mt-2">B1 Listening Interactive Worksheet</p>
                </header>

                <main id="exercise-container">
                    <!-- Section 1: Warm-up -->
                    <div class="bg-white p-8 rounded-xl shadow-lg worksheet-section" id="warm-up-section">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-3 text-slate-900"><span class="bg-sky-100 text-sky-700 font-semibold text-sm px-3 py-1 rounded-full">1</span>Warm-up Discussion</h3>
                        <p class="mb-4 text-slate-600">Before you listen, discuss these questions with a partner:</p>
                        <ul class="list-disc list-inside space-y-3 text-slate-700 marker:text-sky-500">
                           <li>What are the most important things a government does for its people?</li>
                           <li>Do you think a technology company could run a city or a country better than a government? Why or why not?</li>
                           <li>If you could create a new country, what would be its most important rule?</li>
                        </ul>
                    </div>
                    
                    <!-- Section 2: Vocabulary Matching -->
                    <div class="bg-white p-8 rounded-xl shadow-lg worksheet-section" id="vocab-section">
                        <h3 class="text-xl font-bold mb-2 flex items-center gap-3 text-slate-900"><span class="bg-sky-100 text-sky-700 font-semibold text-sm px-3 py-1 rounded-full">2</span>Vocabulary Matching</h3>
                        <p class="text-slate-600 mb-6">Match the words from the podcast (1-8) with their correct definitions (a-h).</p>
                        <div id="vocab-container" class="space-y-4">
                            <!-- Vocab items will be injected by JS -->
                        </div>
                        <div class="section-controls flex justify-end items-center mt-6 gap-4 border-t border-slate-200 pt-4"></div>
                    </div>

                    <!-- Section 3: Comprehension: True or False -->
                    <div class="bg-white p-8 rounded-xl shadow-lg worksheet-section" id="tf-section">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-3 text-slate-900"><span class="bg-sky-100 text-sky-700 font-semibold text-sm px-3 py-1 rounded-full">3</span>Comprehension: True or False?</h3>
                         <p class="text-slate-600 mb-6">Listen to the podcast. Are the following statements true or false?</p>
                        <div class="my-6">
                            <a href="https://www.linguahouse.com/esl-lesson-plans/business-english/how-big-tech-plans-to-create-new-nations/audioplayer/how-big-tech-plans-to-create-new-nations-bemp3" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center bg-blue-600 text-white font-bold py-2 px-5 rounded-lg hover:bg-blue-700 transition-colors duration-300 shadow-md shadow-blue-500/20">
                                <i data-feather="play-circle" class="w-5 h-5 mr-2"></i>
                                Listen to the audio
                            </a>
                        </div>
                        <div id="true-false-container" class="space-y-5">
                            <!-- True/False questions will be injected by JS -->
                        </div>
                        <div class="section-controls flex justify-end items-center mt-6 gap-4 border-t border-slate-200 pt-4"></div>
                    </div>

                    <!-- Section 4: Summary: Fill in the Blanks -->
                    <div class="bg-white p-8 rounded-xl shadow-lg worksheet-section" id="summary-section">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-3 text-slate-900"><span class="bg-sky-100 text-sky-700 font-semibold text-sm px-3 py-1 rounded-full">4</span>Summary: Fill in the Blanks</h3>
                        <p class="text-slate-600 mb-6">Listen again and complete the summary with the words from the box.</p>
                        <div class="my-6">
                            <a href="https://www.linguahouse.com/esl-lesson-plans/business-english/how-big-tech-plans-to-create-new-nations/audioplayer/how-big-tech-plans-to-create-new-nations-bemp3" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center bg-blue-600 text-white font-bold py-2 px-5 rounded-lg hover:bg-blue-700 transition-colors duration-300 shadow-md shadow-blue-500/20">
                                <i data-feather="play-circle" class="w-5 h-5 mr-2"></i>
                                Listen to the audio
                            </a>
                        </div>
                        <div class="p-4 bg-sky-50 border border-sky-200 rounded-lg mb-6">
                            <p class="text-center font-semibold text-sky-800 mb-1">Word Bank</p>
                            <p class="text-center text-sm text-sky-700 leading-relaxed">online | governments | regulation | land | network state | entrepreneurs | laws | disruption</p>
                        </div>
                        <p id="summary-container" class="text-slate-700 leading-loose text-lg"></p>
                        <div class="section-controls flex justify-end items-center mt-6 gap-4 border-t border-slate-200 pt-4"></div>
                    </div>

                    <!-- Section 5: Comprehension: Fill in the Table -->
                    <div class="bg-white p-8 rounded-xl shadow-lg worksheet-section" id="table-section">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-3 text-slate-900"><span class="bg-sky-100 text-sky-700 font-semibold text-sm px-3 py-1 rounded-full">5</span>Comprehension: Fill in the Table</h3>
                        <p class="text-slate-600 mb-6">Listen one more time and complete the table with information about the new country concepts.</p>
                        <div class="my-6">
                            <a href="https://www.linguahouse.com/esl-lesson-plans/business-english/how-big-tech-plans-to-create-new-nations/audioplayer/how-big-tech-plans-to-create-new-nations-bemp3" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center bg-blue-600 text-white font-bold py-2 px-5 rounded-lg hover:bg-blue-700 transition-colors duration-300 shadow-md shadow-blue-500/20">
                                <i data-feather="play-circle" class="w-5 h-5 mr-2"></i>
                                Listen to the audio
                            </a>
                        </div>
                        <div class="overflow-x-auto border border-slate-200 rounded-lg">
                            <table class="w-full text-left" id="table-container">
                                <!-- Table content will be injected by JS -->
                            </table>
                        </div>
                        <div class="section-controls flex justify-end items-center mt-6 gap-4 border-t border-slate-200 pt-4"></div>
                    </div>

                    <!-- Section 6: Scenario-Based Task -->
                    <div class="bg-white p-8 rounded-xl shadow-lg worksheet-section" id="scenario-section">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-3 text-slate-900"><span class="bg-sky-100 text-sky-700 font-semibold text-sm px-3 py-1 rounded-full">6</span>Scenario-based Task: Design Your Own State!</h3>
                        <div class="bg-blue-50 border-l-4 border-blue-400 p-4 rounded-r-lg">
                        <p class="text-slate-600 mb-3">Work in a small group. Imagine you are tech entrepreneurs who are creating a new "network state" or "charter city". Plan your new society and present it to the class.</p>
                        <p class="mb-2 font-semibold text-slate-700">Discuss and decide on:</p>
                        <ul class="list-disc list-inside space-y-2 text-slate-700">
                           <li><b>The Name:</b> What is your new city/country called?</li>
                           <li><b>The Location:</b> Where is it? (e.g., a tropical island, a floating city, the desert)</li>
                           <li><b>Three Main Laws:</b> What are the most important rules for your citizens?</li>
                           <li><b>One Key Service:</b> What is one important service your company will provide? (e.g., super-fast internet, free public transport, advanced healthcare)</li>
                           <li><b>Why should people move there?</b> Give one big reason your state is better than a traditional country.</li>
                        </ul>
                         <p class="mt-4 text-sm text-slate-600 font-medium">Prepare a short (1-2 minute) presentation for the class.</p>
                        </div>
                    </div>
                </main>
                
                 <!-- Audio Player Link (hidden, for template purposes) -->
                <div class="text-center my-8 p-4 bg-white rounded-lg shadow-md" style="display: none;">
                    <a href="https://www.linguahouse.com/esl-lesson-plans/business-english/how-big-tech-plans-to-create-new-nations/audioplayer/how-big-tech-plans-to-create-new-nations-bemp3" target="_blank" rel="noopener noreferrer" class="inline-flex items-center justify-center bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors duration-300 shadow-lg shadow-blue-500/20 w-full sm:w-auto">
                        <i data-feather="play-circle" class="w-6 h-6 mr-2"></i>
                        Click here to listen to the audio
                    </a>
                </div>

                <!-- Main Navigation Control -->
                <div class="flex justify-between items-center mt-8">
                    <button id="prev-section-btn" class="inline-flex items-center gap-2 bg-white text-slate-700 font-bold py-2 px-4 rounded-lg hover:bg-slate-100 disabled:bg-slate-50 disabled:cursor-not-allowed disabled:text-slate-400 transition-colors shadow-sm border border-slate-200">
                        <i data-feather="arrow-left" class="w-4 h-4"></i> Previous
                    </button>
                    <button id="next-section-btn" class="inline-flex items-center gap-2 bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 disabled:bg-blue-300 disabled:cursor-not-allowed transition-colors shadow-lg shadow-blue-500/20">
                        Next <i data-feather="arrow-right" class="w-4 h-4"></i>
                    </button>
                </div>
                
                 <footer class="text-center mt-12 text-sm text-slate-500">
                    <p>Designed by Fajarudin Akbar | <a href="https://fajarudinakbar.online" target="_blank" class="hover:text-blue-600">fajarudinakbar.online</a></p>
                 </footer>
            </div>
        </div>
    </div>
   
<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- DATA ---
    const vocabData = [
        { term: '1. far-fetched', answer: 'd' }, { term: '2. disruption', answer: 'g' },
        { term: '3. making inroads', answer: 'e' }, { term: '4. deep pockets', answer: 'c' },
        { term: '5. pliant', answer: 'h' }, { term: '6. hallmarks', answer: 'a' },
        { term: '7. disconcerting', answer: 'b' }, { term: '8. beholden to', answer: 'f' }
    ];
    const vocabDefinitions = [
        { id: 'a', text: 'typical features or qualities of something' }, { id: 'b', text: 'making someone feel worried or uncertain' },
        { id: 'c', text: 'having a lot of money' }, { id: 'd', text: 'difficult to believe; very unlikely' },
        { id: 'e', text: 'starting to have an important effect or be successful' }, { id: 'f', text: 'feeling that you have a duty to do something for someone' },
        { id: 'g', text: 'changing the traditional way an industry operates' }, { id: 'h', text: 'easily influenced or controlled by others' }
    ];
    const trueFalseData = [
        { question: 'Some tech entrepreneurs think technology can do a better job than governments.', answer: true, explanation: 'The podcast states that some tech entrepreneurs believe "governments are failing and that technology could do a better job".' },
        { question: 'Zack Durban believes the idea of tech companies starting countries is impossible.', answer: false, explanation: 'He says the idea might seem "far-fetched", but it is "actually making inroads".' },
        { question: 'The concept of a country starting online is called the "network state".', answer: true, explanation: 'This is the term used by Balaji Srinivasan for a community that forms online first, then buys land.' },
        { question: 'Charter cities are known for having very high taxes and many regulations.', answer: false, explanation: 'The podcast describes them as having "ultra-low taxes and almost no regulation".' },
        { question: 'Pr√≥spera is a private city located on an island near Nigeria.', answer: false, explanation: 'Pr√≥spera is located on an island in Honduras, not Nigeria.' },
        { question: 'Pr√≥spera has its own flag and armed forces.', answer: false, explanation: 'The podcast explains that Pr√≥spera does not have hallmarks of a country like a flag or armed forces.' },
        { question: 'The government of Honduras gave Pr√≥spera special permission to create its own laws.', answer: true, explanation: 'Yes, the government of Honduras created a special economic zone that allows Pr√≥spera to make its own laws.' },
        { question: 'The presenter thinks people will be comfortable with the idea of "unregulated" services.', answer: false, explanation: 'The presenter finds the idea of "unregulated" services "disconcerting" or worrying.' }
    ];
    const summaryAnswers = ['entrepreneurs', 'governments', 'disruption', 'network state', 'online', 'land', 'laws', 'regulation'];
    const tableAnswers = ['online', 'land', 'laws', 'Pr√≥spera', 'taxes', 'regulation'];
    const tableSelectOptions = [
        ['online', 'offline', 'in-person'], ['money', 'land', 'servers'],
        ['laws', 'currency', 'language'], ['Utopia', 'Techlandia', 'Pr√≥spera'],
        ['fees', 'taxes', 'salaries'], ['oversight', 'freedom', 'regulation']
    ];
    
    // --- STATE ---
    const sections = document.querySelectorAll('.worksheet-section');
    const navContainer = document.getElementById('lesson-nav');
    const prevBtn = document.getElementById('prev-section-btn');
    const nextBtn = document.getElementById('next-section-btn');
    let currentSectionIndex = 0;
    const completedSections = new Set();
    
    // --- NAVIGATION ---
    function setupNavigation() {
        sections.forEach((section, index) => {
            const title = section.querySelector('h3').textContent.replace(/^\d+\s*/, '');
            const navItem = document.createElement('a');
            navItem.href = '#';
            navItem.dataset.index = index;
            navItem.className = 'nav-item flex items-center gap-3 p-2 rounded-md transition-colors text-slate-600 font-medium';
            navItem.innerHTML = `<span class="nav-status-icon w-5 h-5 flex items-center justify-center rounded-full border-2 border-slate-300"></span><span>${title}</span>`;
            navItem.addEventListener('click', (e) => { e.preventDefault(); currentSectionIndex = index; updateView(); });
            navContainer.appendChild(navItem);
        });
    }

    function updateView() {
        sections.forEach((section, index) => section.classList.toggle('active', index === currentSectionIndex));
        document.querySelectorAll('.nav-item').forEach((item, index) => {
            const icon = item.querySelector('.nav-status-icon');
            item.classList.remove('bg-sky-100', 'text-sky-800', 'font-bold');
            icon.innerHTML = '';
            icon.className = 'nav-status-icon w-5 h-5 flex items-center justify-center rounded-full border-2';

            if (completedSections.has(index)) {
                icon.classList.add('border-emerald-500', 'bg-emerald-500', 'text-white');
                icon.innerHTML = `<i data-feather="check" class="w-3 h-3"></i>`;
            } else { icon.classList.add('border-slate-300'); }
            if (index === currentSectionIndex) {
                item.classList.add('bg-sky-100', 'text-sky-800', 'font-bold');
                icon.classList.remove('border-slate-300');
                icon.classList.add('border-sky-500');
                icon.innerHTML = `<span class="w-2 h-2 bg-sky-500 rounded-full"></span>`;
            }
        });
        feather.replace();
        prevBtn.disabled = currentSectionIndex === 0;
        nextBtn.disabled = currentSectionIndex === sections.length - 1;
        window.scrollTo(0, 0);
    }

    prevBtn.addEventListener('click', () => { if (currentSectionIndex > 0) { currentSectionIndex--; updateView(); } });
    nextBtn.addEventListener('click', () => { if (currentSectionIndex < sections.length - 1) { currentSectionIndex++; updateView(); } });

    // --- RENDER FUNCTIONS ---
    function renderVocabulary() {
        const container = document.getElementById('vocab-container');
        const shuffledDefinitions = [...vocabDefinitions].sort(() => Math.random() - 0.5);
        let optionsHTML = '<option value="">Select definition...</option>';
        shuffledDefinitions.forEach(def => { optionsHTML += `<option value="${def.id}">${def.id}. ${def.text}</option>`; });
        vocabData.forEach((item, index) => {
            container.innerHTML += `
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
                    <p class="font-medium text-slate-800">${item.term}</p>
                    <select class="vocab-select border border-slate-300 rounded-lg p-2 w-full shadow-sm bg-white" data-index="${index}">${optionsHTML}</select>
                </div>`;
        });
    }

    function renderTrueFalse() {
        const container = document.getElementById('true-false-container');
        container.innerHTML = '';
        trueFalseData.forEach((item, index) => {
            container.innerHTML += `
                <div class="tf-question p-4 border border-slate-200 rounded-lg" data-index="${index}">
                    <p class="mb-3 font-medium text-slate-800">${index + 1}. ${item.question}</p>
                    <div class="flex space-x-4">
                        <input type="radio" id="tf${index}-true" name="tf${index}" value="true" class="tf-radio"><label for="tf${index}-true" class="cursor-pointer">True</label>
                        <input type="radio" id="tf${index}-false" name="tf${index}" value="false" class="tf-radio"><label for="tf${index}-false" class="cursor-pointer">False</label>
                    </div>
                    <div class="explanation" style="display: none;"></div>
                </div>`;
        });
    }

    function renderSummary() {
        document.getElementById('summary-container').innerHTML = `In the podcast, Zack Durban discusses the new idea of tech (1) <span class="input-wrapper"><input type="text" class="summary-blank" data-index="0"></span> starting their own countries. They believe technology can do a better job than traditional (2) <span class="input-wrapper"><input type="text" class="summary-blank" data-index="1"></span>. This concept, part of Silicon Valley's love for (3) <span class="input-wrapper"><input type="text" class="summary-blank" data-index="2"></span>, is being seriously considered. One idea, called the (4) <span class="input-wrapper"><input type="text" class="summary-blank" data-index="3"></span>, suggests that communities would first form (5) <span class="input-wrapper"><input type="text" class="summary-blank" data-index="4"></span>. After that, they would buy (6) <span class="input-wrapper"><input type="text" class="summary-blank" data-index="5"></span> and create their own (7) <span class="input-wrapper"><input type="text" class="summary-blank" data-index="6"></span>. These new places, like charter cities, often have very low taxes and little (8) <span class="input-wrapper"><input type="text" class="summary-blank" data-index="7"></span>, which some people find worrying.`;
        document.querySelectorAll('.summary-blank').forEach(el => el.classList.add('mx-1', 'p-1', 'border-b-2', 'border-slate-300', 'focus:outline-none', 'focus:border-blue-500', 'transition', 'text-center', 'font-medium', 'bg-slate-50', 'w-36'));
    }

    function renderTable() {
        const container = document.getElementById('table-container');
        const createSelect = (index) => {
            const options = tableSelectOptions[index].sort(() => Math.random() - 0.5).map(opt => `<option value="${opt.toLowerCase()}">${opt}</option>`).join('');
            return `<span class="input-wrapper"><select class="table-select border border-slate-300 rounded-lg p-1.5 shadow-sm bg-white" data-index="${index}"><option value=""></option>${options}</select></span>`;
        };
        container.innerHTML = `
            <thead class="bg-slate-100"><tr class="divide-x divide-slate-200">
                <th class="p-3 text-xs font-semibold text-slate-600 uppercase tracking-wider">Concept</th><th class="p-3 text-xs font-semibold text-slate-600 uppercase tracking-wider">Proponent / Example</th>
                <th class="p-3 text-xs font-semibold text-slate-600 uppercase tracking-wider">How it works</th><th class="p-3 text-xs font-semibold text-slate-600 uppercase tracking-wider">Key Features</th>
            </tr></thead>
            <tbody class="bg-white divide-y divide-slate-200">
                <tr class="divide-x divide-slate-200">
                    <td class="p-3 font-semibold">Network State</td><td class="p-3">Balaji Srinivasan</td>
                    <td class="p-3">1. Forms as an (1) ${createSelect(0)} community.<br>2. Acquires physical (2) ${createSelect(1)}.</td>
                    <td class="p-3">Has its own (3) ${createSelect(2)}.</td>
                </tr>
                <tr class="divide-x divide-slate-200">
                    <td class="p-3 font-semibold">Charter/Private City</td><td class="p-3">(4) ${createSelect(3)} (Honduras)</td>
                    <td class="p-3">Built as an urban area from the start.</td>
                    <td class="p-3">‚Ä¢ Ultra-low (5) ${createSelect(4)} <br>‚Ä¢ Almost no (6) ${createSelect(5)} <br>‚Ä¢ Can make its own laws</td>
                </tr>
            </tbody>`;
    }

    // --- EVENT LISTENERS & LOGIC ---
    function setupSection(sectionId, checkFn, resetFn) {
        const section = document.getElementById(sectionId);
        const controls = section.querySelector('.section-controls');
        controls.innerHTML = `
            <div class="score-container text-md font-bold text-slate-800" style="display: none;"></div>
            <button class="check-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors shadow-md shadow-blue-500/20 text-sm">Check Answers</button>`;
        
        const checkButton = controls.querySelector('.check-btn');
        checkButton.addEventListener('click', () => {
            checkFn(section); // Grade the section & show answers/explanations
            // Update button states
            checkButton.style.display = 'none';
        });
    }

    // --- CHECKING & FEEDBACK LOGIC ---
    function checkVocab(section) {
        let score = 0;
        resetVocab(section, true);
        section.querySelectorAll('.vocab-select').forEach((select) => {
            const index = parseInt(select.dataset.index);
            const isCorrect = select.value === vocabData[index].answer;
            select.classList.toggle('correct', isCorrect);
            select.classList.toggle('incorrect', !isCorrect);
            if (isCorrect) {
                score++;
            } else {
                const correctAnswerId = vocabData[index].answer;
                const correctDefinition = vocabDefinitions.find(def => def.id === correctAnswerId);
                const answerSpan = document.createElement('span');
                answerSpan.className = 'correct-answer-text ml-2 text-sm';
                answerSpan.textContent = `(Correct: ${correctDefinition.id}. ${correctDefinition.text})`;
                select.closest('.grid').appendChild(answerSpan);
            }
        });
        updateScore(section, score, vocabData.length);
    }

    function checkTrueFalse(section) {
        let score = 0;
        resetTrueFalse(section, true);
        section.querySelectorAll('.tf-question').forEach((q, index) => {
            const selected = q.querySelector(`input[name="tf${index}"]:checked`);
            const isCorrect = selected && (JSON.parse(selected.value) === trueFalseData[index].answer);

            if (isCorrect) {
                score++;
                q.classList.add('correct');
            } else {
                q.classList.add('incorrect'); // Mark incorrect if wrong or unanswered
                const correctRadio = q.querySelector(`input[value="${trueFalseData[index].answer}"]`);
                if (correctRadio) correctRadio.classList.add('correct-radio');
            }
            
            // Always show explanation
            const data = trueFalseData[index];
            const explanationDiv = q.querySelector('.explanation');
            explanationDiv.innerHTML = `<p class="mt-2 p-3 bg-slate-50 text-slate-700 rounded-md border-l-4 border-slate-300">${data.explanation}</p>`;
            explanationDiv.style.display = 'block';
        });
        updateScore(section, score, trueFalseData.length);
    }

    function checkSummary(section) {
        let score = 0;
        resetSummary(section, true);
        section.querySelectorAll('.summary-blank').forEach((input) => {
            const index = parseInt(input.dataset.index);
            const isCorrect = input.value.trim().toLowerCase() === summaryAnswers[index];
            input.classList.toggle('correct', isCorrect);
            input.classList.toggle('incorrect', !isCorrect);
            if (isCorrect) {
                score++;
            } else {
                const answerSpan = document.createElement('span');
                answerSpan.className = 'correct-answer-text ml-1 text-sm';
                answerSpan.textContent = `(${summaryAnswers[index]})`;
                input.closest('.input-wrapper').appendChild(answerSpan);
            }
        });
        updateScore(section, score, summaryAnswers.length);
    }
    
    function checkTable(section) {
        let score = 0;
        resetTable(section, true);
        section.querySelectorAll('.table-select').forEach((select) => {
            const index = parseInt(select.dataset.index);
            const isCorrect = select.value.trim().toLowerCase() === tableAnswers[index];
            select.classList.toggle('correct', isCorrect);
            select.classList.toggle('incorrect', !isCorrect);
            if(isCorrect) {
                score++;
            } else {
                const answerSpan = document.createElement('span');
                answerSpan.className = 'correct-answer-text ml-2 text-sm';
                answerSpan.textContent = `(${tableAnswers[index]})`;
                select.closest('.input-wrapper').appendChild(answerSpan);
            }
        });
        updateScore(section, score, tableAnswers.length);
    }

    function updateScore(section, score, maxScore) {
        if (score === maxScore) completedSections.add(currentSectionIndex);
        updateView();
        const scoreContainer = section.querySelector('.score-container');
        scoreContainer.textContent = `Score: ${score} / ${maxScore}`;
        scoreContainer.style.display = 'block';
        section.querySelector('.check-btn').style.display = 'none';
    }

    // --- RESET LOGIC ---
    const resetStyles = (section, partial) => {
        if (!partial) {
            completedSections.delete(currentSectionIndex);
            updateView();
        }
        section.querySelectorAll('.correct, .incorrect').forEach(el => el.classList.remove('correct', 'incorrect'));
        section.querySelectorAll('.correct-answer-text').forEach(el => el.remove());
        section.querySelectorAll('.explanation').forEach(el => { el.style.display = 'none'; el.innerHTML = ''; });
        section.querySelector('.score-container').style.display = 'none';
        section.querySelector('.check-btn').style.display = 'inline-flex';
    };

    function resetVocab(section, partial = false) { resetStyles(section, partial); if(!partial) section.querySelectorAll('.vocab-select').forEach(s => s.selectedIndex = 0); }
    function resetTrueFalse(section, partial = false) { resetStyles(section, partial); section.querySelectorAll('.correct-radio').forEach(el => el.classList.remove('correct-radio')); if(!partial) section.querySelectorAll('.tf-radio').forEach(r => r.checked = false); }
    function resetSummary(section, partial = false) { resetStyles(section, partial); if(!partial) section.querySelectorAll('.summary-blank').forEach(i => i.value = ''); }
    function resetTable(section, partial = false) { resetStyles(section, partial); if(!partial) section.querySelectorAll('.table-select').forEach(s => s.selectedIndex = 0); }

    // --- INITIALIZE APP ---
    function initialize() {
        feather.replace();
        setupNavigation();
        renderVocabulary();
        renderTrueFalse();
        renderSummary();
        renderTable();

        setupSection('vocab-section', checkVocab, resetVocab);
        setupSection('tf-section', checkTrueFalse, resetTrueFalse);
        setupSection('summary-section', checkSummary, resetSummary);
        setupSection('table-section', checkTable, resetTable);
        
        updateView();
    }

    initialize();
});
</script>
</body>
</html>
