<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>B1 Reading Worksheet: Is Gold a Safe Investment?</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/feather-icons"></script>
    <style>
        /* Base styles */
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        
        /* Section animations */
        .worksheet-section {
            display: none;
        }
        .worksheet-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Drag and drop styles */
        .draggable {
            cursor: move;
            transition: all 0.2s ease-in-out;
        }
        .dragging {
            opacity: 0.5;
            transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            background-color: #ffffff;
        }
        .drop-target {
            border: 2px dashed #cbd5e1; /* slate-300 */
            transition: all 0.2s ease;
        }
        .drag-over {
            background-color: #f0f9ff; /* sky-50 */
            border-color: #38bdf8; /* sky-400 */
        }

        /* Answer feedback styles */
        .correct {
            border-color: #10b981 !important; /* emerald-500 */
            background-color: #ecfdf5 !important; /* emerald-50 */
        }
        .incorrect {
            border-color: #f43f5e !important; /* rose-500 */
            background-color: #fff1f2 !important; /* rose-50 */
        }
        .correct-answer-text {
            color: #047857; /* emerald-700 */
            font-weight: 600;
        }
        .explanation {
            border-left: 4px solid #60a5fa; /* blue-400 */
            padding-left: 12px;
            background-color: #eff6ff; /* blue-50 */
        }
        .tf-btn.selected {
            background-color: #3b82f6 !important; /* blue-500 */
            color: white !important;
            border-color: #3b82f6 !important; /* blue-500 */
        }
        .summary-input.correct, .table-select.correct {
             border-color: #10b981 !important;
             box-shadow: 0 0 0 2px #a7f3d0;
        }
        .summary-input.incorrect, .table-select.incorrect {
             border-color: #f43f5e !important;
             box-shadow: 0 0 0 2px #fecdd3;
        }

        /* Hide scrollbar for the sidebar on webkit browsers */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="flex min-h-screen">
        <!-- Sidebar Navigation -->
        <aside class="w-64 bg-white border-r border-slate-200 p-6 flex-col hidden md:flex">
            <nav id="lesson-nav" class="space-y-2 flex-1 no-scrollbar overflow-y-auto"></nav>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 p-4 sm:p-6 lg:p-10">
            <div class="max-w-4xl mx-auto">
                <header class="mb-10">
                    <div class="p-4 bg-amber-400 rounded-full w-12 h-12 flex items-center justify-center mb-4 text-2xl">
                        ðŸª™
                    </div>
                    <h1 class="text-3xl md:text-4xl font-extrabold text-slate-900 tracking-tight">Is Gold a Safe Investment?</h1>
                    <p class="text-lg text-slate-600 mt-2">An Interactive B1 Level Reading Worksheet</p>
                </header>

                <main id="exercise-container">
                    <!-- Section 1: Warm-up -->
                    <div class="bg-white p-8 rounded-xl shadow-lg worksheet-section" id="warm-up-section">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-3 text-slate-900"><span class="bg-sky-100 text-sky-700 font-semibold text-sm px-3 py-1 rounded-full">1</span>Warm-up Discussion</h3>
                        <ul class="list-disc list-inside space-y-3 text-slate-700 marker:text-sky-500">
                            <li>What do people do when they want to save money for the future?</li>
                            <li>Why do you think gold is so valuable around the world?</li>
                            <li>Have you heard of investing in stocks or gold? What does it mean?</li>
                        </ul>
                    </div>
                    
                    <!-- Section 2: Vocabulary Matching -->
                    <div class="bg-white p-8 rounded-xl shadow-lg worksheet-section" id="vocab-section">
                        <h3 class="text-xl font-bold mb-2 flex items-center gap-3 text-slate-900"><span class="bg-sky-100 text-sky-700 font-semibold text-sm px-3 py-1 rounded-full">2</span>Vocabulary Matching</h3>
                        <p class="text-slate-600 mb-6">Drag the word to its correct definition.</p>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div id="words-container" class="space-y-3 md:col-span-1 border-r-0 md:border-r md:pr-6 border-slate-200"></div>
                            <div id="definitions-container" class="space-y-2 md:col-span-2"></div>
                        </div>
                        <div class="section-controls flex justify-end items-center mt-6 gap-4 border-t border-slate-200 pt-4"></div>
                    </div>

                    <!-- Section 3: Reading + True or False -->
                    <div class="bg-white p-8 rounded-xl shadow-lg worksheet-section" id="tf-section">
                        <div class="reading-passage-container"></div>
                        <hr class="my-8 border-slate-200">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-3 text-slate-900"><span class="bg-sky-100 text-sky-700 font-semibold text-sm px-3 py-1 rounded-full">3</span>True or False?</h3>
                        <div id="true-false-container" class="space-y-5"></div>
                        <div class="section-controls flex justify-end items-center mt-6 gap-4 border-t border-slate-200 pt-4"></div>
                    </div>

                    <!-- Section 4: Reading + Summary -->
                    <div class="bg-white p-8 rounded-xl shadow-lg worksheet-section" id="summary-section">
                        <div class="reading-passage-container"></div>
                        <hr class="my-8 border-slate-200">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-3 text-slate-900"><span class="bg-sky-100 text-sky-700 font-semibold text-sm px-3 py-1 rounded-full">4</span>Summary Fill-in-the-Blank</h3>
                        <div class="p-4 bg-sky-50 border border-sky-200 rounded-lg mb-6">
                            <p class="text-center font-semibold text-sky-800 mb-1">Word Bank</p>
                            <p class="text-center text-sm text-sky-700 leading-relaxed">protect, prices, central banks, valuable, safe-haven, stocks, investment, risks, economy, portfolio</p>
                        </div>
                        <p id="summary-container" class="text-slate-700 leading-loose text-lg"></p>
                        <div class="section-controls flex justify-end items-center mt-6 gap-4 border-t border-slate-200 pt-4"></div>
                    </div>

                    <!-- Section 5: Reading + Table -->
                    <div class="bg-white p-8 rounded-xl shadow-lg worksheet-section" id="table-section">
                        <div class="reading-passage-container"></div>
                        <hr class="my-8 border-slate-200">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-3 text-slate-900"><span class="bg-sky-100 text-sky-700 font-semibold text-sm px-3 py-1 rounded-full">5</span>Table Fill-in-the-Blank</h3>
                        <div class="overflow-x-auto border border-slate-200 rounded-lg">
                            <table class="min-w-full" id="table-container">
                                <thead class="bg-slate-100">
                                    <tr class="divide-x divide-slate-200">
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider w-1/3">Time Period / Factor</th>
                                        <th class="px-4 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider">How Gold Behaved / Result</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white"></tbody>
                            </table>
                        </div>
                        <div class="section-controls flex justify-end items-center mt-6 gap-4 border-t border-slate-200 pt-4"></div>
                    </div>

                    <!-- Section 6: Scenario-Based Task -->
                    <div class="bg-white p-8 rounded-xl shadow-lg worksheet-section" id="scenario-section">
                        <h3 class="text-xl font-bold mb-4 flex items-center gap-3 text-slate-900"><span class="bg-sky-100 text-sky-700 font-semibold text-sm px-3 py-1 rounded-full">6</span>Scenario-Based Task</h3>
                        <p class="text-slate-600 mb-3">Your friend has saved some money and wants to invest all of it in gold. Based on the article, write a short message (3-4 sentences) explaining why they should be careful.</p>
                        <textarea id="scenario-task" class="w-full p-3 border border-slate-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition" rows="5" placeholder="Write your advice here..."></textarea>
                    </div>
                </main>
                
                <!-- Main Navigation Control -->
                <div class="flex justify-between items-center mt-8">
                    <button id="prev-section-btn" class="inline-flex items-center gap-2 bg-white text-slate-700 font-bold py-2 px-4 rounded-lg hover:bg-slate-100 disabled:bg-slate-50 disabled:cursor-not-allowed disabled:text-slate-400 transition-colors shadow-sm border border-slate-200">
                        <i data-feather="arrow-left" class="w-4 h-4"></i> Previous
                    </button>
                    <button id="next-section-btn" class="inline-flex items-center gap-2 bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 disabled:bg-blue-300 disabled:cursor-not-allowed transition-colors shadow-lg shadow-blue-500/20">
                        Next <i data-feather="arrow-right" class="w-4 h-4"></i>
                    </button>
                </div>
                
                 <footer class="text-center mt-12 text-sm text-slate-500">
                    <p>Designed by Fajarudin Akbar | <a href="https://fajarudinakbar.online" target="_blank" class="hover:text-blue-600">fajarudinakbar.online</a></p>
                 </footer>
            </div>
        </div>
    </div>
   
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- DATA (Unchanged) ---
            const vocabData = [
                { id: 'v1', word: 'Investment', answer: 'j' }, { id: 'v2', word: 'Risky', answer: 'g' },
                { id: 'v3', word: 'Inflation', answer: 'i' }, { id: 'v4', word: 'Interest Rates', answer: 'f' },
                { id: 'v5', word: 'Portfolio', answer: 'a' }, { id: 'v6', word: 'Safe-haven', answer: 'd' },
                { id: 'v7', word: 'Protect', answer: 'c' }, { id: 'v8', word: 'Recovering', answer: 'e' },
                { id: 'v9', word: 'Uncertainty', answer: 'b' }, { id: 'v10', word: 'Rare', answer: 'h' }
            ];
            const definitions = {
                a: 'A collection of different investments owned by a person.', b: 'The state of not being known or definite.',
                c: 'To keep safe from harm or injury.', d: 'An investment that is expected to keep its value when the economy is bad.',
                e: 'Returning to a normal state of health or strength.', f: 'The percentage a bank charges you to borrow money.',
                g: 'Involving a chance of loss or danger.', h: 'Not common; very unusual.',
                i: 'When prices for everything go up and money buys less.', j: 'Something you buy because you hope its value will increase and make you a profit.'
            };
            const trueFalseData = [
                { question: 'Gold prices are currently at their lowest point in history.', answer: false, explanation: 'The text states prices reached a "record high in April".' },
                { question: 'In the past, gold was a good investment when the stock market was doing badly.', answer: true, explanation: 'Correct. The text says, "In the past, gold prices usually went up when stock prices went down."' },
                { question: 'Today, gold and stock prices are moving in opposite directions.', answer: false, explanation: 'The text mentions that "gold and stocks are rising at the same time."' },
                { question: 'Central banks are buying more gold because they are worried about the US dollar.', answer: true, explanation: 'Correct. They are worried about "the US dollar\'s role as the main world currency."' },
                { question: 'The text says gold will probably become worthless in the future.', answer: false, explanation: 'The text says it will "likely stay important for investors."' },
                { question: 'Gold prices reached a record high in April of the year the article was written.', answer: true, explanation: 'Correct. The first sentence confirms this.' },
                { question: 'In the late 1990s, gold prices went up when stock markets were strong.', answer: false, explanation: 'The text states that in the late 1990s, "gold prices fell when stock markets were strong."' },
                { question: 'Hope about AI technology is one reason stock markets are rising.', answer: true, explanation: 'Correct. Stock markets are rising because people are "hopeful about AI technology."' },
                { question: 'Exchange-traded funds (ETFs) make it more difficult for people to invest in gold.', answer: false, explanation: 'The text says ETFs "make it easy for people to invest in gold."' },
                { question: 'One use for gold mentioned in the text is for making jewellery.', answer: true, explanation: 'Correct. The text states gold is "used in jewellery and manufacturing."' }
            ];
            const summaryAnswers = ['safe-haven', 'protect', 'economy', 'prices', 'stocks', 'risks', 'central banks', 'investment', 'portfolio', 'valuable'];
            const tableDropdownData = [
                { factor: '1. The 1970s (weak economy)', prompt: 'Gold prices {dropdown}.', answer: ['rose', 'went up'], options: ['rose', 'fell', 'rising', 'record'] },
                { factor: '2. The late 1990s (strong stock markets)', prompt: 'Gold prices {dropdown}.', answer: ['fell', 'went down'], options: ['fell', 'rose', 'stocks', 'easy'] },
                { factor: '3. After the 2009 financial crisis', prompt: 'Gold started to move more like {dropdown}.', answer: ['stocks'], options: ['stocks', 'record', 'uncertainty', 'rising'] },
                { factor: '4. April (in the text)', prompt: 'Gold prices reached a {dropdown} high.', answer: ['record'], options: ['record', 'rare', 'fell', 'easy'] },
                { factor: '5. A recovering world economy', prompt: 'Stock markets are {dropdown}.', answer: ['rising'], options: ['rising', 'fell', 'buying', 'rose'] },
                { factor: '6. The invention of ETFs', prompt: 'It became {dropdown} to invest in gold.', answer: ['easy', 'easier'], options: ['easy', 'difficult', 'stocks', 'rare'] },
                { factor: '7. Wars and political tensions', prompt: 'These risks make investors {dropdown} gold.', answer: ['buy'], options: ['buy', 'sell', 'fell', 'rising'] },
                { factor: "8. Central banks' worries about the US dollar", prompt: 'They are {dropdown} more gold.', answer: ['buying'], options: ['buying', 'selling', 'rose', 'record'] },
                { factor: "9. US President Donald Trump's policies", prompt: 'They create {dropdown}.', answer: ['uncertainty'], options: ['uncertainty', 'stocks', 'easy', 'rare'] },
                { factor: "10. Gold's general nature", prompt: 'It is {dropdown} and used in jewellery.', answer: ['rare'], options: ['rare', 'common', 'record', 'rising'] }
            ];

            // --- UI Elements ---
            const sections = document.querySelectorAll('.worksheet-section');
            const navContainer = document.getElementById('lesson-nav');
            const prevBtn = document.getElementById('prev-section-btn');
            const nextBtn = document.getElementById('next-section-btn');
            let currentSectionIndex = 0;
            const completedSections = new Set();

            // --- NAVIGATION ---
            function setupNavigation() {
                sections.forEach((section, index) => {
                    const title = section.querySelector('h3').textContent.replace(/^\d+\s*/, '');
                    const navItem = document.createElement('a');
                    navItem.href = '#';
                    navItem.dataset.index = index;
                    navItem.className = 'nav-item flex items-center gap-3 p-2 rounded-md transition-colors text-slate-600 font-medium';
                    navItem.innerHTML = `
                        <span class="nav-status-icon w-5 h-5 flex items-center justify-center rounded-full border-2 border-slate-300"></span>
                        <span>${title}</span>
                    `;
                    navItem.addEventListener('click', (e) => {
                        e.preventDefault();
                        currentSectionIndex = index;
                        updateView();
                    });
                    navContainer.appendChild(navItem);
                });
            }

            function updateView() {
                sections.forEach((section, index) => {
                    section.classList.toggle('active', index === currentSectionIndex);
                });

                document.querySelectorAll('.nav-item').forEach((item, index) => {
                    const icon = item.querySelector('.nav-status-icon');
                    item.classList.remove('bg-sky-100', 'text-sky-800', 'font-bold');
                    icon.innerHTML = '';
                    icon.className = 'nav-status-icon w-5 h-5 flex items-center justify-center rounded-full border-2';

                    if (completedSections.has(index)) {
                        item.classList.add('text-slate-600');
                        icon.classList.add('border-emerald-500', 'bg-emerald-500', 'text-white');
                        icon.innerHTML = `<i data-feather="check" class="w-3 h-3"></i>`;
                    } else {
                        icon.classList.add('border-slate-300');
                    }
                    
                    if (index === currentSectionIndex) {
                        item.classList.add('bg-sky-100', 'text-sky-800', 'font-bold');
                        icon.classList.remove('border-slate-300');
                        icon.classList.add('border-sky-500');
                        icon.innerHTML = `<span class="w-2 h-2 bg-sky-500 rounded-full"></span>`;
                    }
                });

                feather.replace();
                prevBtn.disabled = currentSectionIndex === 0;
                nextBtn.disabled = currentSectionIndex === sections.length - 1;
                window.scrollTo(0, 0); 
            }

            prevBtn.addEventListener('click', () => { if (currentSectionIndex > 0) { currentSectionIndex--; updateView(); } });
            nextBtn.addEventListener('click', () => { if (currentSectionIndex < sections.length - 1) { currentSectionIndex++; updateView(); } });

            // --- RENDER FUNCTIONS ---
            function renderReadingPassage() {
                const passageHTML = `
                    <h2 class="text-2xl font-bold mb-4 text-slate-900">Reading Passage</h2>
                    <article class="prose max-w-none text-slate-700 space-y-4">
                        <h3 class="text-xl font-semibold text-slate-800">Why Gold May Not Be the "Safe" Investment It Used to Be</h3>
                        <p>Gold prices reached a record high in April and are still close to that level. Many people think gold is a "safe-haven" investmentâ€”something to buy when the economy is in trouble, because it is less risky than stocks.</p>
                        <p>In the past, gold prices usually went up when stock prices went down. This helped investors protect their money. But now, gold and stocks are rising at the same time. This means gold may not work as well as a safety net anymore.</p>
                        <h4 class="font-semibold text-slate-800">How Gold Behaved Before</h4>
                        <p>In the 1970s, gold prices rose when oil prices went up and the economy was weak. In the late 1990s, gold prices fell when stock markets were strong. After the 2009 financial crisis, gold prices started to move more like stocks.</p>
                        <h4 class="font-semibold text-slate-800">Why This Is Happening Now</h4>
                        <p>The world economy is recovering from high inflation and high interest rates... Stock markets are rising because of this and because people are hopeful about AI technology.</p>
                        <p>At the same time, there are risks: Wars and tensions... and uncertainty from US President Donald Trump's trade policies...</p>
                        <h4 class="font-semibold text-slate-800">Gold as a Normal Investment</h4>
                        <p>Since the early 2000s, gold has been traded more like other investments, especially through exchange-traded funds (ETFs). These make it easy for people to invest in gold. Central banks are also buying more gold because they are worried about the US dollar's role as the main world currency...</p>
                        <h4 class="font-semibold text-slate-800">Gold Still Has Value</h4>
                        <p>Gold is rare, used in jewellery and manufacturing, and valued all over the world. Even if it is no longer the perfect safety investment, it will likely stay important for investors.</p>
                        <p class="text-sm text-slate-500 italic">Adapted from theconversation.com</p>
                    </article>
                `;
                document.querySelectorAll('.reading-passage-container').forEach(c => c.innerHTML = passageHTML);
            }

            function renderVocabulary() {
                const wordsContainer = document.getElementById('words-container');
                const definitionsContainer = document.getElementById('definitions-container');
                const shuffledWords = [...vocabData].sort(() => Math.random() - 0.5);
                wordsContainer.innerHTML = '';
                definitionsContainer.innerHTML = '';
                shuffledWords.forEach(item => {
                    wordsContainer.innerHTML += `<div id="${item.id}" class="draggable bg-amber-100 p-2 rounded-md border border-amber-300 text-center font-semibold text-amber-900" draggable="true">${item.word}</div>`;
                });
                Object.keys(definitions).forEach(key => {
                    definitionsContainer.innerHTML += `<div class="flex items-center space-x-3"><div id="drop-${key}" data-answer="${key}" class="drop-target h-12 w-20 rounded-md flex items-center justify-center"></div><p class="flex-1 text-slate-700">${definitions[key]}</p></div>`;
                });
            }

            function renderTrueFalse() {
                const container = document.getElementById('true-false-container');
                container.innerHTML = '';
                trueFalseData.forEach((item, index) => {
                    container.innerHTML += `
                        <div class="tf-question p-4 border border-slate-200 rounded-lg" data-index="${index}">
                            <p class="mb-3 font-medium text-slate-800">${index + 1}. ${item.question}</p>
                            <div class="flex space-x-2">
                                <button class="tf-btn border-2 border-slate-300 rounded-md px-4 py-1.5 font-semibold hover:bg-slate-100 transition-colors" data-value="true">True</button>
                                <button class="tf-btn border-2 border-slate-300 rounded-md px-4 py-1.5 font-semibold hover:bg-slate-100 transition-colors" data-value="false">False</button>
                            </div>
                            <div class="explanation text-sm text-slate-700 mt-3 p-3 rounded-md" style="display: none;"></div>
                        </div>`;
                });
            }

            function renderSummary() {
                document.getElementById('summary-container').innerHTML = `Gold is often seen as a (1) <span class="input-wrapper"><input data-index="0" type="text" class="summary-input"></span> investment, a way for people to (2) <span class="input-wrapper"><input data-index="1" type="text" class="summary-input"></span> their money when the (3) <span class="input-wrapper"><input data-index="2" type="text" class="summary-input"></span> is in trouble. In the past, gold (4) <span class="input-wrapper"><input data-index="3" type="text" class="summary-input"></span> usually went up when (5) <span class="input-wrapper"><input data-index="4" type="text" class="summary-input"></span> went down. However, this has changed. Today, both are rising together, partly because of political (6) <span class="input-wrapper"><input data-index="5" type="text" class="summary-input"></span> and the actions of (7) <span class="input-wrapper"><input data-index="6" type="text" class="summary-input"></span>, which are buying more gold. It is now treated less as a safety net and more like a normal (8) <span class="input-wrapper"><input data-index="7" type="text" class="summary-input"></span>. For many modern investors, gold is often just one part of a mixed (9) <span class="input-wrapper"><input data-index="8" type="text" class="summary-input"></span>. Even with these changes, gold will likely remain (10) <span class="input-wrapper"><input data-index="9" type="text" class="summary-input"></span> because it is rare and has many uses.`;
                document.querySelectorAll('.summary-input').forEach(el => el.classList.add('w-32', 'mx-1', 'p-1', 'border-b-2', 'border-slate-300', 'focus:outline-none', 'focus:border-blue-500', 'transition', 'text-center', 'font-medium', 'bg-slate-50'));
            }
            
            function renderTable() {
                const tbody = document.querySelector('#table-container tbody');
                tbody.innerHTML = '';
                tableDropdownData.forEach((item, index) => {
                    const optionsHTML = [...item.options].sort(() => Math.random() - 0.5).map(opt => `<option value="${opt}">${opt}</option>`).join('');
                    const selectHTML = `<select data-index="${index}" class="table-select inline-block w-36 p-1.5 border border-slate-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 transition bg-white shadow-sm"><option value="" disabled selected>Select...</option>${optionsHTML}</select>`;
                    const promptHTML = item.prompt.replace('{dropdown}', selectHTML);
                    tbody.innerHTML += `<tr class="border-t border-slate-200 divide-x divide-slate-200"><td class="px-4 py-4 align-top font-medium text-slate-800">${item.factor}</td><td class="px-4 py-4 align-top text-slate-700">${promptHTML}</td></tr>`;
                });
            }

            // --- EVENT LISTENERS & LOGIC ---
            function setupSection(sectionId, checkFn, resetFn) {
                const section = document.getElementById(sectionId);
                const controls = section.querySelector('.section-controls');
                controls.innerHTML = `
                    <div class="score-container text-md font-bold text-slate-800" style="display: none;"></div>
                    <button class="retry-btn bg-white text-slate-700 font-bold py-2 px-4 rounded-lg hover:bg-slate-100 transition-colors shadow-sm border border-slate-200 text-sm" style="display: none;">Retry</button>
                    <button class="check-btn bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors shadow-md shadow-blue-500/20 text-sm">Check Answers</button>
                `;
                controls.querySelector('.check-btn').addEventListener('click', () => checkFn(section));
                controls.querySelector('.retry-btn').addEventListener('click', () => resetFn(section));
            }

            function setupDragDrop() {
                let draggedItem = null;
                document.addEventListener('dragstart', e => { if (e.target.classList.contains('draggable')) { draggedItem = e.target; setTimeout(() => e.target.classList.add('dragging'), 0); } });
                document.addEventListener('dragend', e => { if (e.target.classList.contains('draggable')) { e.target.classList.remove('dragging'); } });
                document.querySelectorAll('.drop-target').forEach(target => {
                    target.addEventListener('dragover', e => { e.preventDefault(); target.classList.add('drag-over'); });
                    target.addEventListener('dragleave', () => target.classList.remove('drag-over'));
                    target.addEventListener('drop', e => {
                        e.preventDefault();
                        target.classList.remove('drag-over');
                        if (draggedItem) {
                            if (target.firstChild) document.getElementById('words-container').appendChild(target.firstChild);
                            target.appendChild(draggedItem);
                        }
                    });
                });
            }
            
            document.getElementById('true-false-container').addEventListener('click', e => {
                if (e.target.classList.contains('tf-btn')) {
                    const parent = e.target.parentElement;
                    parent.querySelectorAll('.tf-btn').forEach(btn => btn.classList.remove('selected'));
                    e.target.classList.add('selected');
                }
            });

            // --- CHECKING LOGIC ---
             function checkVocab(section) {
                let score = 0;
                resetVocab(section, true);
                section.querySelectorAll('.drop-target').forEach(target => {
                    const letter = target.dataset.answer;
                    const correctWordId = vocabData.find(v => v.answer === letter).id;
                    const droppedItem = target.querySelector('.draggable');
                    if (droppedItem && droppedItem.id === correctWordId) {
                        score++;
                        target.classList.add('correct');
                    } else {
                        target.classList.add('incorrect');
                        const correctWord = vocabData.find(v => v.id === correctWordId).word;
                        const answerSpan = document.createElement('span');
                        answerSpan.className = 'correct-answer-text ml-2 text-sm';
                        answerSpan.textContent = `(Correct: ${correctWord})`;
                        target.parentElement.appendChild(answerSpan);
                    }
                });
                updateScore(section, '.score-container', score, vocabData.length);
            }

            function checkTrueFalse(section) {
                let score = 0;
                resetTrueFalse(section, true);
                section.querySelectorAll('.tf-question').forEach((q, index) => {
                    const selectedBtn = q.querySelector('.tf-btn.selected');
                    const explanationDiv = q.querySelector('.explanation');
                    if (selectedBtn) {
                        const isCorrect = JSON.parse(selectedBtn.dataset.value) === trueFalseData[index].answer;
                        if (isCorrect) { score++; selectedBtn.classList.add('correct'); } 
                        else {
                            selectedBtn.classList.add('incorrect');
                            explanationDiv.innerHTML = `<strong class="text-rose-700">Correct Answer: ${trueFalseData[index].answer ? 'True' : 'False'}.</strong> ${trueFalseData[index].explanation}`;
                            explanationDiv.style.display = 'block';
                        }
                    } else {
                        q.querySelector('.flex').classList.add('incorrect', 'p-2', 'rounded-md');
                        explanationDiv.innerHTML = `<strong class="text-rose-700">Correct Answer: ${trueFalseData[index].answer ? 'True' : 'False'}.</strong> ${trueFalseData[index].explanation}`;
                        explanationDiv.style.display = 'block';
                    }
                });
                updateScore(section, '.score-container', score, trueFalseData.length);
            }

            function checkFillIn(section, inputSelector, answerArray, scoreSelector) {
                let score = 0;
                resetFillIn(section, true);
                section.querySelectorAll(inputSelector).forEach(input => {
                    const index = parseInt(input.dataset.index);
                    const correctAnswers = Array.isArray(answerArray[index]) ? answerArray[index] : [answerArray[index]];
                    const isCorrect = correctAnswers.some(ans => ans && ans.toLowerCase() === input.value.trim().toLowerCase());
                    if (isCorrect) { score++; input.classList.add('correct'); } 
                    else {
                        input.classList.add('incorrect');
                        const answerSpan = document.createElement('span');
                        answerSpan.className = 'correct-answer-text ml-1 text-sm';
                        answerSpan.textContent = `(${correctAnswers[0]})`;
                        input.parentElement.appendChild(answerSpan);
                    }
                });
                updateScore(section, scoreSelector, score, answerArray.length);
            }

            function checkTable(section) {
                let score = 0;
                resetTable(section, true);
                section.querySelectorAll('.table-select').forEach(select => {
                    const index = parseInt(select.dataset.index);
                    const correctAnswers = tableDropdownData[index].answer;
                    const isCorrect = correctAnswers.includes(select.value.toLowerCase());
                    if (isCorrect) {
                        score++;
                        select.classList.add('correct');
                    } else {
                        select.classList.add('incorrect');
                        const answerSpan = document.createElement('span');
                        answerSpan.className = 'correct-answer-text ml-2 text-sm';
                        answerSpan.textContent = `(Correct: ${correctAnswers[0]})`;
                        select.after(answerSpan);
                    }
                });
                updateScore(section, '.score-container', score, tableDropdownData.length);
            }
            
            function updateScore(section, containerClass, score, maxScore) {
                completedSections.add(currentSectionIndex);
                updateView();
                const scoreContainer = section.querySelector(containerClass);
                scoreContainer.textContent = `Score: ${score} / ${maxScore}`;
                scoreContainer.style.display = 'block';
                section.querySelector('.retry-btn').style.display = 'inline-flex';
                section.querySelector('.check-btn').style.display = 'none';
            }

            // --- RESET LOGIC ---
            function resetVocab(section, partial = false) {
                if (!partial) {
                    const wordsContainer = section.querySelector('#words-container');
                    section.querySelectorAll('.drop-target .draggable').forEach(word => wordsContainer.appendChild(word));
                    completedSections.delete(currentSectionIndex);
                    updateView();
                }
                section.querySelectorAll('.correct, .incorrect').forEach(el => el.classList.remove('correct', 'incorrect'));
                section.querySelectorAll('.correct-answer-text').forEach(el => el.remove());
                section.querySelector('.score-container').style.display = 'none';
                section.querySelector('.retry-btn').style.display = 'none';
                section.querySelector('.check-btn').style.display = 'inline-flex';
            }

            function resetTrueFalse(section, partial = false) {
                if (!partial) { 
                    section.querySelectorAll('.tf-btn.selected').forEach(btn => btn.classList.remove('selected')); 
                    completedSections.delete(currentSectionIndex);
                    updateView();
                }
                section.querySelectorAll('.correct, .incorrect').forEach(el => el.classList.remove('correct', 'incorrect', 'p-2', 'rounded-md'));
                section.querySelectorAll('.explanation').forEach(el => el.style.display = 'none');
                section.querySelector('.score-container').style.display = 'none';
                section.querySelector('.retry-btn').style.display = 'none';
                section.querySelector('.check-btn').style.display = 'inline-flex';
            }
            
            function resetFillIn(section, partial = false) {
                if (!partial) { 
                    section.querySelectorAll('input').forEach(input => input.value = ''); 
                    completedSections.delete(currentSectionIndex);
                    updateView();
                }
                section.querySelectorAll('.correct, .incorrect').forEach(el => el.classList.remove('correct', 'incorrect'));
                section.querySelectorAll('.correct-answer-text').forEach(el => el.remove());
                section.querySelector('.score-container').style.display = 'none';
                section.querySelector('.retry-btn').style.display = 'none';
                section.querySelector('.check-btn').style.display = 'inline-flex';
            }

            function resetTable(section, partial = false) {
                if (!partial) {
                    section.querySelectorAll('.table-select').forEach(select => select.selectedIndex = 0);
                    completedSections.delete(currentSectionIndex);
                    updateView();
                }
                section.querySelectorAll('.correct, .incorrect').forEach(el => el.classList.remove('correct', 'incorrect'));
                section.querySelectorAll('.correct-answer-text').forEach(el => el.remove());
                section.querySelector('.score-container').style.display = 'none';
                section.querySelector('.retry-btn').style.display = 'none';
                section.querySelector('.check-btn').style.display = 'inline-flex';
            }

            // --- INITIALIZE APP ---
            function initialize() {
                feather.replace();
                setupNavigation();
                renderReadingPassage();
                renderVocabulary();
                renderTrueFalse();
                renderSummary();
                renderTable();
                setupDragDrop();
                
                setupSection('vocab-section', checkVocab, resetVocab);
                setupSection('tf-section', checkTrueFalse, resetTrueFalse);
                setupSection('summary-section', (sec) => checkFillIn(sec, '.summary-input', summaryAnswers, '.score-container'), (sec) => resetFillIn(sec));
                setupSection('table-section', checkTable, resetTable);

                updateView();
            }

            initialize();
        });
    </script>
</body>
</html>

